<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.ai.gzesp.dao.PayDao">

	
	<select id="queryUserIdByOrderId" resultType="java.util.HashMap">
        select user_id
          from ORD_D_DEAL
         where order_id = ${order_id}
	</select>		
	
	<update id="updatePayStateAndIncomeMoney">
         update ord_d_base
            set order_state = #{order_state} ,
                income_money = ${income_money}
          where order_id = ${order_id}
	</update>	
	
	<insert id="insertDealLog">
      insert into ORD_L_DEALLOG
             (operate_logid, order_id, partition_id, operate_time, operator_id, operator_name, 
              deal_content, result_code, result_info, original_state,current_state)
       values(${operate_logid}, ${order_id}, ${partition_id}, sysdate, '00000', '后台更新', 
              #{deal_content}, #{result_code}, #{result_info}, #{original_state}, #{current_state})
	</insert>
	
	<select id="queryOrderDPay" resultType="java.util.HashMap">
        select order_id, pay_order, pay_type, pay_mode, pay_state, pay_fee, pay_time
          from ord_d_pay
         where order_id = ${order_id}
	</select>	
	
	<insert id="insertPayInfoBatch">
      insert into ord_d_pay 
             (order_id, partition_id, pay_order, pay_type, pay_mode, pay_state, order_fee, pay_fee, pay_time)
      select order_id, partition_id, pay_order, pay_type, pay_mode, pay_state, order_fee, pay_fee, pay_time
        from (
      <foreach collection="list" item="item" index="index" separator=" union all ">        
       select ${item.order_id} order_id, ${item.partition_id} partition_id, ${item.pay_order} pay_order, #{item.pay_type} pay_type, #{item.pay_mode} pay_mode, #{item.pay_state} pay_state, ${item.order_fee} order_fee, ${item.pay_fee} pay_fee, to_date(#{item.pay_time},'yyyymmddhh24miss') pay_time from dual    
      </foreach>
        )
	</insert>	
	
	<update id="updateOrdDPay">
         update ord_d_pay
            set pay_state = #{pay_state}
          where order_id = ${order_id}
            <if test="pay_mode != null">
            and pay_mode = #{pay_mode}
            </if>
	</update>	
	
	<select id="queryPhoneByOrderId" resultType="java.util.HashMap">
        select phone_number
          from ord_d_cust
         where order_id = ${order_id}
	</select>	

	<select id="queryGoodsNameByOrderId" resultType="java.util.HashMap">
        select goods_name
          from ord_d_prod
         where order_id = ${order_id}
	</select>		
</mapper>