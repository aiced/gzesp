<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.ai.gzesp.dao.PayDao">

	
	<select id="queryUserIdByOrderId" resultType="java.util.HashMap">
        select user_id
          from ORD_D_DEAL
         where order_id = ${order_id}
	</select>		
	
	<update id="updatePayStateAndIncomeMoney">
         update ord_d_base
            set order_state = #{order_state} ,
                income_money = ${income_money}
          where order_id = ${order_id}
	</update>	
	
	<insert id="insertDealLog">
      insert into ORD_L_DEALLOG
             (operate_logid, order_id, partition_id, operate_time, operator_id, operator_name, 
              deal_content, result_code, result_info, original_state,current_state)
       values(${operate_logid}, ${order_id}, ${partition_id}, sysdate, '00000', '后台更新', 
              #{deal_content}, #{result_code}, #{result_info}, #{original_state}, #{current_state})
	</insert>
	
	<select id="queryOrderDPay" resultType="java.util.HashMap">
        select order_id, pay_order, pay_type, pay_mode, pay_state, pay_fee, pay_time
          from ord_d_pay
         where order_id = ${order_id}
	</select>	
	
	<!-- 一定得是SELECT,不能是INSERT或者UPDATE,否则就要报错。。  -->
	<select id="insertPayInfoBatch">
      insert into ord_d_pay 
             (order_id, partition_id, pay_order, pay_type, pay_mode, pay_state, order_fee, pay_fee, pay_time)
      <foreach collection="list" item="item" index="index" separator="union all">        
       select ${item.order_id}, ${item.partition_id}, ${item.pay_order}, #{item.pay_type}, #{item.pay_mode}, #{item.pay_state}, ${item.order_fee}, ${item.pay_fee}, to_date(#{item.pay_time},'yyyymmddhh24miss') from dual   
      </foreach>
	</select>	
	
	<update id="updateOrdDPay">
         update ord_d_pay
            set pay_state = #{pay_state}
          where order_id = ${order_id}
            <if test="pay_mode != null">
            and pay_mode = #{pay_mode}
            </if>
	</update>	
	
	<select id="queryPhoneByOrderId" resultType="java.util.HashMap">
        select phone_number
          from ord_d_cust
         where order_id = ${order_id}
	</select>	

	<select id="queryGoodsNameByOrderId" resultType="java.util.HashMap">
        select goods_name
          from ord_d_prod
         where order_id = ${order_id}
	</select>
	
	<select id="queryPayModeByOrderId" resultType="java.util.HashMap">
        select order_id, pay_order, pay_type, pay_mode
          from ord_d_pay
         where order_id = ${order_id}
	</select>	
	
	<update id="updatePayRefundState">
         update ord_d_refund
            set refund_state = #{refund_state}
          where order_id = ${order_id}
	</update>

	<update id="updatePayState">
         update ord_d_base
            set order_state = #{order_state}
          where order_id = ${order_id}
	</update>	

	<select id="queryRefundInfoByOrderId" resultType="java.util.HashMap">
        select order_id, order_state
          from ord_d_refund
         where order_id = ${order_id}
	</select>	
							
</mapper>